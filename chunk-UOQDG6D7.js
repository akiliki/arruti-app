import{a as J}from"./chunk-T6BMFCRC.js";import{a as B,c as Y,e as M,h as U,k as q,l as W,m as G,o as Z}from"./chunk-F5WL7XU5.js";import{a as K}from"./chunk-LIV6L26T.js";import"./chunk-ORCUSZZD.js";import{Aa as H,Da as j,F as a,K as m,M as s,N as v,P as r,Q as o,R as y,U as h,V as u,W as p,X as T,Y as d,Z as b,_,ba as F,ca as V,d as k,da as x,ea as E,fa as w,ga as $,h as P,i as S,l as C,m as I,oa as z,pa as R,qa as A,ra as N,sa as L,t as O,u as D,y as g,z as f}from"./chunk-ALWVHIEC.js";var ee=i=>["/obrador/pedidos",i];function te(i,t){if(i&1&&(r(0,"option",18),d(1),o()),i&2){let e=t.$implicit;s("value",e),a(),b(e)}}function ne(i,t){if(i&1&&(r(0,"div",35)(1,"strong"),d(2,"NOTA:"),o(),d(3),o()),i&2){let e=p().$implicit;a(3),_(" ",e.notasPastelero," ")}}function ie(i,t){if(i&1){let e=h();r(0,"button",36),u("click",function(){g(e);let l=p().$implicit,c=p(2);return f(c.updateStatus(l.id,"En Proceso"))}),d(1),o()}if(i&2){let e=p().$implicit,n=p(2);s("disabled",n.updatingId===e.id),a(),_(" ",n.updatingId===e.id?"...":"EMPEZAR"," ")}}function oe(i,t){if(i&1){let e=h();r(0,"button",37),u("click",function(){g(e);let l=p().$implicit,c=p(2);return f(c.updateStatus(l.id,"Producido"))}),d(1),o()}if(i&2){let e=p().$implicit,n=p(2);s("disabled",n.updatingId===e.id),a(),_(" ",n.updatingId===e.id?"...":"TERMINAR"," ")}}function re(i,t){i&1&&(r(0,"span",38),d(1,"PRODUCIDO \u2713"),o())}function de(i,t){i&1&&(r(0,"span",38),d(1,"ENTREGADO \u2713"),o())}function ae(i,t){if(i&1&&(r(0,"div",22)(1,"div",23)(2,"span",24),d(3),x(4,"date"),o(),r(5,"span",25),d(6),x(7,"date"),o()(),r(8,"div",26)(9,"div",27),d(10),o(),r(11,"div",28),d(12),o(),m(13,ne,4,1,"div",29),o(),r(14,"div",30),m(15,ie,2,2,"button",31)(16,oe,2,2,"button",32)(17,re,2,0,"span",33)(18,de,2,0,"span",33),r(19,"button",34),d(20," VER DETALLE "),o()()()),i&2){let e=t.$implicit,n=p(2);v("in-process",e.estado==="En Proceso")("urgent",n.isUrgent(e.fechaEntrega)),a(3),b(w(4,14,e.fechaEntrega,"HH:mm")),a(3),b(n.isToday(e.fechaEntrega)?"HOY":w(7,17,e.fechaEntrega,"dd/MM")),a(4),_("",e.cantidad,"u."),a(2),b(e.producto),a(),s("ngIf",e.notasPastelero),a(2),s("ngIf",e.estado==="Pendiente"),a(),s("ngIf",e.estado==="En Proceso"),a(),s("ngIf",e.estado==="Producido"),a(),s("ngIf",e.estado==="Entregado"),a(),s("routerLink",V(20,ee,e.id))}}function ce(i,t){i&1&&(r(0,"div",39),d(1," No hay productos pendientes de producir. "),o())}function se(i,t){if(i&1&&(r(0,"div",19),m(1,ae,21,22,"div",20)(2,ce,2,0,"div",21),o()),i&2){let e=t.ngIf;a(),s("ngForOf",e),a(),s("ngIf",e.length===0)}}function le(i,t){i&1&&(r(0,"div",40),d(1,"Cargando producci\xF3n..."),o())}var Q=class i{productionService=O(J);productoService=O(K);refresh$=new k(void 0);updatingId=null;isRefreshing=!0;showOnlyPending=!0;familiaFilter=new M("");fechaFilter=new M(this.formatDate(new Date));familias$;filteredPedidos$;constructor(){this.familias$=this.productoService.getProductos().pipe(P(t=>[...new Set(t.map(e=>e.familia))].sort()))}ngOnInit(){let t=this.refresh$.pipe(I(()=>this.productionService.getPedidos()));this.filteredPedidos$=S([t,this.familiaFilter.valueChanges.pipe(C(this.familiaFilter.value)),this.fechaFilter.valueChanges.pipe(C(this.fechaFilter.value))]).pipe(P(([e,n,l])=>e.filter(c=>c.estado!=="Entregado").filter(c=>!n||c.producto.startsWith(n)||this.belongsToFamilia(c,n)).filter(c=>!l||this.formatDate(c.fechaEntrega)===l).filter(c=>this.showOnlyPending?c.estado==="Pendiente"||c.estado==="En Proceso":!0).sort((c,X)=>c.fechaEntrega.getTime()-X.fechaEntrega.getTime()))),setInterval(()=>this.refresh$.next(),3e4)}belongsToFamilia(t,e){return t.producto.toLowerCase().includes(e.toLowerCase())}togglePending(){this.showOnlyPending=!this.showOnlyPending,this.refresh$.next()}changeDay(t){let e=this.fechaFilter.value;if(!e)return;let n=new Date(e);n.setDate(n.getDate()+t),this.fechaFilter.setValue(this.formatDate(n))}setToday(){this.fechaFilter.setValue(this.formatDate(new Date))}updateStatus(t,e){this.updatingId=t,this.productionService.updatePedidoStatus(t,e).subscribe({next:()=>{this.updatingId=null,this.refresh$.next()},error:n=>{alert(n.message),this.updatingId=null}})}formatDate(t){return t.toISOString().split("T")[0]}isToday(t){let e=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}isUrgent(t){if(!this.isToday(t))return!1;let e=new Date;return(t.getTime()-e.getTime())/(1e3*60*60)<3}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-pedidos-obrador"]],standalone:!0,features:[F],decls:37,vars:13,consts:[["loading",""],[1,"obrador-container"],[1,"header"],[1,"auto-refresh"],[1,"dot"],[1,"filters"],[1,"filter-group"],[3,"formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"date-nav"],["title","D\xEDa Anterior",1,"btn-nav",3,"click"],["type","date",3,"formControl"],["title","D\xEDa Siguiente",1,"btn-nav",3,"click"],[1,"btn-today",3,"click"],[1,"toggle-group"],[1,"btn-toggle",3,"click"],["class","production-grid",4,"ngIf","ngIfElse"],[3,"value"],[1,"production-grid"],["class","order-card",3,"in-process","urgent",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"order-card"],[1,"card-header"],[1,"time"],[1,"delivery-date"],[1,"card-body"],[1,"quantity"],[1,"product-name"],["class","baker-notes",4,"ngIf"],[1,"card-actions"],["class","btn-start",3,"disabled","click",4,"ngIf"],["class","btn-finish",3,"disabled","click",4,"ngIf"],["class","badge-done",4,"ngIf"],[1,"btn-view-order",3,"routerLink"],[1,"baker-notes"],[1,"btn-start",3,"click","disabled"],[1,"btn-finish",3,"click","disabled"],[1,"badge-done"],[1,"empty-state"],[1,"loading-state"]],template:function(e,n){if(e&1){let l=h();r(0,"div",1)(1,"div",2)(2,"h2"),d(3,"Producci\xF3n de Obrador"),o(),r(4,"div",3),y(5,"span",4),d(6," Auto-actualizando cada 30s "),o()(),r(7,"div",5)(8,"div",6)(9,"label"),d(10,"Familia:"),o(),r(11,"select",7)(12,"option",8),d(13,"Todas las familias"),o(),m(14,te,2,2,"option",9),x(15,"async"),o()(),r(16,"div",6)(17,"label"),d(18,"Fecha:"),o(),r(19,"div",10)(20,"button",11),u("click",function(){return g(l),f(n.changeDay(-1))}),d(21,"\u2039"),o(),y(22,"input",12),r(23,"button",13),u("click",function(){return g(l),f(n.changeDay(1))}),d(24,"\u203A"),o(),r(25,"button",14),u("click",function(){return g(l),f(n.setToday())}),d(26,"HOY"),o()()(),r(27,"div",6)(28,"label"),d(29,"Ver solo:"),o(),r(30,"div",15)(31,"button",16),u("click",function(){return g(l),f(n.togglePending())}),d(32," En Producci\xF3n / Pendiente "),o()()()(),m(33,se,3,2,"div",17),x(34,"async"),m(35,le,2,0,"ng-template",null,0,$),o()}if(e&2){let l=T(36);a(5),v("active",n.isRefreshing),a(6),s("formControl",n.familiaFilter),a(3),s("ngForOf",E(15,9,n.familias$)),a(8),s("formControl",n.fechaFilter),a(9),v("active",n.showOnlyPending),a(2),s("ngIf",E(34,11,n.filteredPedidos$))("ngIfElse",l)}},dependencies:[L,z,R,A,N,Z,W,G,B,q,Y,U,j,H],styles:[".obrador-container[_ngcontent-%COMP%]{padding:20px;background:#f0f2f5;min-height:100vh}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.auto-refresh[_ngcontent-%COMP%]{font-size:.8rem;color:#666;display:flex;align-items:center;gap:8px}.dot[_ngcontent-%COMP%]{width:8px;height:8px;background:#ccc;border-radius:50%}.dot.active[_ngcontent-%COMP%]{background:#2ecc71;box-shadow:0 0 5px #2ecc71;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.4}to{opacity:1}}.filters[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:25px;align-items:flex-end}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem}.date-nav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#fff;padding:4px;border-radius:8px;border:1px solid #ddd}.date-nav[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;padding:6px;font-weight:700;outline:none}.btn-nav[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;padding:4px 12px;cursor:pointer;font-size:1.2rem;color:#495057;display:flex;align-items:center;justify-content:center}.btn-nav[_ngcontent-%COMP%]:hover{background:#e9ecef}.btn-today[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;border:none;padding:6px 12px;border-radius:4px;font-weight:700;font-size:.8rem;cursor:pointer;margin-left:5px}.btn-today[_ngcontent-%COMP%]:hover{background:#bbdefb}select[_ngcontent-%COMP%]{padding:10px;border-radius:6px;border:1px solid #ddd;min-width:150px}.btn-toggle[_ngcontent-%COMP%]{padding:8px 15px;border:1px solid #ddd;background:#fff;border-radius:6px;cursor:pointer}.btn-toggle.active[_ngcontent-%COMP%]{background:#34495e;color:#fff;border-color:#34495e}.production-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}.order-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px #0000000d;overflow:hidden;display:flex;flex-direction:column;border-top:6px solid #95a5a6;transition:transform .2s}.order-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.order-card.in-process[_ngcontent-%COMP%]{border-top-color:#3498db;background:#ebf5fb}.order-card.urgent[_ngcontent-%COMP%]{border-top-color:#e74c3c}.card-header[_ngcontent-%COMP%]{padding:10px 15px;display:flex;justify-content:space-between;align-items:center;background:#00000005;border-bottom:1px solid #eee}.time[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#2c3e50}.delivery-date[_ngcontent-%COMP%]{font-weight:700;color:#7f8c8d;font-size:.9rem}.card-body[_ngcontent-%COMP%]{padding:15px;flex-grow:1}.quantity[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:800;color:#d35400;line-height:1;margin-bottom:5px}.product-name[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#2c3e50;margin-bottom:10px}.baker-notes[_ngcontent-%COMP%]{background:#fff9c4;padding:10px;border-radius:6px;font-size:.95rem;color:#856404;border-left:4px solid #fbc02d}.card-actions[_ngcontent-%COMP%]{padding:15px;border-top:1px solid #eee}button[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:1rem}.btn-start[_ngcontent-%COMP%]{background:#3498db;color:#fff}.btn-finish[_ngcontent-%COMP%]{background:#2ecc71;color:#fff}.btn-view-order[_ngcontent-%COMP%]{background:none;color:#7f8c8d;border:1px solid #ddd;margin-top:10px;font-size:.8rem;padding:8px}.btn-view-order[_ngcontent-%COMP%]:hover{background:#f9f9f9;color:#2c3e50;border-color:#bdc3c7}.badge-done[_ngcontent-%COMP%]{color:#27ae60;font-weight:700;display:block;text-align:center}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{grid-column:1/-1;padding:50px;text-align:center;background:#fff;border-radius:12px;color:#666}"]})};export{Q as PedidosObradorComponent};
