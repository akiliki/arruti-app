import{a as $}from"./chunk-NAFMCCRU.js";import{b as T,c as x,d as A,e as j,g as z,j as G,m as L,n as D,o as q,p as B,q as W,r as Y}from"./chunk-74UN4DIZ.js";import"./chunk-BKTZ77TT.js";import{f as N,h as V,i as R,l as k}from"./chunk-MLTMCV35.js";import{$a as l,Ib as O,Ja as c,Jb as I,Ma as s,Mb as w,Pa as i,Qa as n,Ra as p,Sa as F,Ta as S,Ua as b,V as u,Va as v,Wa as f,Z as P,_a as M,ab as C,bb as h,eb as E,fa as g,ga as _,jb as y,ya as d}from"./chunk-ISGLS2OQ.js";function K(a,o){if(a&1&&(i(0,"option",19),l(1),n()),a&2){let e=o.$implicit;s("value",e),d(),C(e)}}function Q(a,o){if(a&1){let e=b();F(0),i(1,"select",15),v("change",function(t){g(e);let m=f();return _(m.onFamilyChange(t))}),i(2,"option",16),l(3,"Seleccione una familia..."),n(),c(4,K,2,2,"option",17),i(5,"option",18),l(6,"+ Crear nueva familia..."),n()(),S()}if(a&2){let e=f();d(4),s("ngForOf",e.familias())}}function U(a,o){if(a&1){let e=b();i(0,"div",20),p(1,"input",21),i(2,"button",22),v("click",function(){g(e);let t=f();return _(t.cancelNewFamily())}),l(3,"Ver lista"),n()()}}function X(a,o){a&1&&(i(0,"div",23),l(1," La familia es obligatoria. "),n())}function Z(a,o){a&1&&(i(0,"div",23),l(1," El nombre es obligatorio. "),n())}function ee(a,o){if(a&1&&(i(0,"div",24),l(1),n()),a&2){let e=f();d(),h(" ",e.errorMessage," ")}}var H=class a{fb=u(W);productoService=u($);router=u(V);route=u(N);familias=this.productoService.familiasSignal;isSubmitting=!1;isEditMode=!1;isNewFamily=!1;productId=null;errorMessage="";productForm=this.fb.group({familia:["",x.required],producto:["",x.required],tallasRaciones:[""],rellenos:[""]});onFamilyChange(o){o.target.value==="NEW_FAMILY"&&(this.isNewFamily=!0,this.productForm.get("familia")?.setValue(""))}cancelNewFamily(){this.isNewFamily=!1,this.productForm.get("familia")?.setValue("")}ngOnInit(){this.productId=this.route.snapshot.paramMap.get("id"),this.productId&&(this.isEditMode=!0,this.loadProducto(this.productId))}loadProducto(o){this.productoService.getProductoById(o).subscribe(e=>{e?this.productForm.patchValue({familia:e.familia,producto:e.producto,tallasRaciones:e.tallasRaciones.join(", "),rellenos:(e.rellenos||[]).join(", ")}):this.errorMessage="Producto no encontrado."})}onSubmit(){if(this.productForm.invalid)return;this.isSubmitting=!0,this.errorMessage="";let o=this.productForm.value,e=o.tallasRaciones?o.tallasRaciones.split(",").map(t=>t.trim()).filter(t=>t!==""):[],r=o.rellenos?o.rellenos.split(",").map(t=>t.trim()).filter(t=>t!==""):[];if(this.isEditMode&&this.productId){let t={id:this.productId,familia:o.familia||"",producto:o.producto||"",tallasRaciones:e,rellenos:r};this.productoService.updateProducto(t).subscribe({next:()=>this.router.navigate(["/productos"]),error:m=>{this.isSubmitting=!1,this.errorMessage=m.message||"Error al actualizar el producto."}})}else{let t={familia:o.familia||"",producto:o.producto||"",tallasRaciones:e,rellenos:r};this.productoService.addProducto(t).subscribe({next:()=>this.router.navigate(["/productos"]),error:m=>{this.isSubmitting=!1,this.errorMessage=m.message||"Error al guardar el producto."}})}}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-producto-form"]],standalone:!0,features:[E],decls:36,vars:9,consts:[["newFamilyInput",""],[1,"form-container"],[1,"header"],["routerLink","/productos",1,"btn-back"],[1,"card",3,"ngSubmit","formGroup"],[1,"field"],[1,"family-selector"],[4,"ngIf","ngIfElse"],["class","error",4,"ngIf"],["type","text","formControlName","producto","placeholder","Ej: Croissant de Mantequilla"],["type","text","formControlName","tallasRaciones","placeholder","Ej: Individual, 4p, 6p (separados por comas)"],["type","text","formControlName","rellenos","placeholder","Ej: Crema, Chocolate, Nata, Sin Relleno..."],[1,"actions"],["type","submit",1,"btn-save",3,"disabled"],["class","error-box",4,"ngIf"],["formControlName","familia",3,"change"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["value","NEW_FAMILY"],[3,"value"],[1,"input-with-action"],["type","text","formControlName","familia","placeholder","Nombre de la nueva familia..."],["type","button",1,"btn-link",3,"click"],[1,"error"],[1,"error-box"]],template:function(e,r){if(e&1){let t=b();i(0,"div",1)(1,"div",2)(2,"h2"),l(3),n(),i(4,"button",3),l(5,"Volver"),n()(),i(6,"form",4),v("ngSubmit",function(){return g(t),_(r.onSubmit())}),i(7,"div",5)(8,"label"),l(9,"Familia"),n(),i(10,"div",6),c(11,Q,7,1,"ng-container",7)(12,U,4,0,"ng-template",null,0,y),n(),c(14,X,2,0,"div",8),n(),i(15,"div",5)(16,"label"),l(17,"Nombre del Producto"),n(),p(18,"input",9),c(19,Z,2,0,"div",8),n(),i(20,"div",5)(21,"label"),l(22,"Raciones / Tama\xF1os (opcional)"),n(),p(23,"input",10),i(24,"small"),l(25,"Si hay varios, sep\xE1relos por comas."),n()(),i(26,"div",5)(27,"label"),l(28,"Rellenos (opcional)"),n(),p(29,"input",11),i(30,"small"),l(31,"Si hay varios, sep\xE1relos por comas."),n()(),i(32,"div",12)(33,"button",13),l(34),n()(),c(35,ee,2,1,"div",14),n()()}if(e&2){let t,m,J=M(13);d(3),C(r.isEditMode?"Editar Producto":"A\xF1adir Nuevo Producto"),d(3),s("formGroup",r.productForm),d(5),s("ngIf",!r.isNewFamily)("ngIfElse",J),d(3),s("ngIf",((t=r.productForm.get("familia"))==null?null:t.touched)&&((t=r.productForm.get("familia"))==null?null:t.invalid)),d(5),s("ngIf",((m=r.productForm.get("producto"))==null?null:m.touched)&&((m=r.productForm.get("producto"))==null?null:m.invalid)),d(14),s("disabled",r.productForm.invalid||r.isSubmitting),d(),h(" ",r.isSubmitting?"Guardando...":r.isEditMode?"Actualizar Producto":"Guardar Producto"," "),d(),s("ngIf",r.errorMessage)}},dependencies:[w,O,I,Y,z,q,B,T,D,A,j,G,L,k,R],styles:[".form-container[_ngcontent-%COMP%]{padding:1rem;max-width:600px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 4px 10px #0000001a}.field[_ngcontent-%COMP%]{margin-bottom:1.5rem;display:flex;flex-direction:column;gap:.4rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#444}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #ddd;border-radius:4px}.field[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#888;font-size:.8rem}.input-with-action[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.input-with-action[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#2196f3;cursor:pointer;font-size:.9rem;padding:.5rem}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.error[_ngcontent-%COMP%]{color:#d32f2f;font-size:.8rem}.error-box[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background:#ffebee;color:#c62828;border-radius:4px}.actions[_ngcontent-%COMP%]{margin-top:2rem}.btn-save[_ngcontent-%COMP%]{width:100%;background:#2196f3;color:#fff;border:none;padding:1rem;border-radius:4px;cursor:pointer;font-weight:600;font-size:1rem}.btn-save[_ngcontent-%COMP%]:disabled{background:#ccc;cursor:not-allowed}.btn-back[_ngcontent-%COMP%]{background:transparent;border:1px solid #ddd;padding:.5rem 1rem;border-radius:4px;cursor:pointer}"]})};export{H as ProductoFormComponent};
