import{a as v,b as S}from"./chunk-LIWVUWVT.js";import{a as l,b as P}from"./chunk-PYUXCCWC.js";import{Da as b,O as m,U as h,a as d,b as c,j as f,n as p,q as a,y as u}from"./chunk-WPZFAPEJ.js";var g=class n{http=h(P);adapter=h(v);apiUrl=S.apiUrl;productosState=new f([]);productosSignal=b([]);loaded=!1;constructor(){this.productosState.subscribe(t=>this.productosSignal.set(t))}getProductos(){return this.loaded||this.refreshProductos().subscribe(),this.productosState.asObservable()}refreshProductos(){return this.http.get(`${this.apiUrl}?type=productos`).pipe(a(t=>{if(t.status==="error")throw new Error(t.message);let r=this.adapter.adaptProductos(t);return this.productosState.next(r),this.loaded=!0,r}),u(t=>(console.error("Error fetching productos:",t),p(()=>new Error("No se pudieron cargar los productos.")))))}getProductoById(t){return this.getProductos().pipe(a(r=>r.find(e=>e.id===t)))}addProducto(t){let r=crypto.randomUUID(),e=c(d({},t),{id:r}),i=this.productosState.value;this.productosState.next([...i,e]);let o=c(d({},this.adapter.prepareProductoForPost(e)),{action:"addProduct"});return this.http.post(this.apiUrl,JSON.stringify(o),{headers:new l({"Content-Type":"text/plain;charset=utf-8"})}).pipe(a(s=>{if(s.status==="error")throw new Error(s.message);return s}),u(s=>(this.productosState.next(i),p(()=>new Error("Error al a\xF1adir. Se ha revertido el cambio.")))))}updateProducto(t){let r=this.productosState.value,e=r.map(o=>o.id===t.id?t:o);this.productosState.next(e);let i=c(d({},this.adapter.prepareProductoForPost(t)),{action:"updateProduct"});return this.http.post(this.apiUrl,JSON.stringify(i),{headers:new l({"Content-Type":"text/plain;charset=utf-8"})}).pipe(a(o=>{if(o.status==="error")throw new Error(o.message);return o}),u(o=>(this.productosState.next(r),p(()=>new Error("Error al actualizar. Se ha revertido el cambio.")))))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{g as a};
