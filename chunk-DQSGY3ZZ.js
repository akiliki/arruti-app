import{a as ie}from"./chunk-VYVNSZGR.js";import{a as q,b as _,c as R,d as L,e as G,f as H,g as J,h as W,i as K,j as U,k as X,l as Y,m as Z,n as ee,o as te}from"./chunk-J4TYNHYF.js";import{a as ne}from"./chunk-QGIMQF2O.js";import"./chunk-EAY7Z6F7.js";import{$ as v,D as l,I as p,K as s,L as k,N as o,O as n,P as b,Q as S,R as u,S as m,U as r,V as E,W as x,X as w,Z as D,aa as h,d as T,h as F,i as O,ka as I,l as M,la as $,ma as N,n as A,oa as B,t as P,u as V,va as j,wa as z,y as C,z as y,za as Q}from"./chunk-II2SJXWV.js";function re(d,t){if(d&1){let i=S();o(0,"button",4),v(1,"async"),u("click",function(){let a=C(i).$implicit,c=m();return y(c.selectFamilia(a))}),r(2),n()}if(d&2){let i=t.$implicit,e=m();k("active",h(1,3,e.selectedFamilia$)===i),l(2),E(i)}}function ae(d,t){if(d&1){let i=S();o(0,"div",39),u("click",function(){let a=C(i).$implicit,c=m(2);return y(c.selectProducto(a))}),o(1,"span",40),r(2),n(),r(3),n()}if(d&2){let i=t.$implicit;l(2),E(i.familia),l(),x(" ",i.producto," ")}}function de(d,t){if(d&1&&(o(0,"div",37),p(1,ae,4,2,"div",38),v(2,"async"),n()),d&2){let i=m();l(),s("ngForOf",h(2,1,i.filteredProductos$))}}function le(d,t){if(d&1){let i=S();o(0,"div",41),r(1," Seleccionado: "),o(2,"strong"),r(3),n(),o(4,"button",42),u("click",function(){let a;C(i);let c=m();return c.selectedProducto=null,(a=c.pedidoForm.get("productoBase"))==null||a.setValue(""),y(c.searchControl.setValue(""))}),r(5,"\xD7"),n()()}if(d&2){let i=m();l(3),w("",i.selectedProducto.familia," - ",i.selectedProducto.producto,"")}}function ce(d,t){d&1&&(o(0,"div",43),r(1," Debe seleccionar un producto del cat\xE1logo. "),n())}function se(d,t){if(d&1&&(o(0,"option",48),r(1),n()),d&2){let i=t.$implicit;s("value",i),l(),E(i)}}function ue(d,t){d&1&&(o(0,"div",43),r(1," Debe seleccionar una talla/raci\xF3n. "),n())}function pe(d,t){if(d&1&&(o(0,"div",2)(1,"label",44),r(2,"Talla / Raciones"),n(),o(3,"select",45)(4,"option",46),r(5,"Seleccione tama\xF1o..."),n(),p(6,se,2,2,"option",47),n(),p(7,ue,2,0,"div",11),n()),d&2){let i,e=m();l(6),s("ngForOf",e.selectedProducto==null?null:e.selectedProducto.tallasRaciones),l(),s("ngIf",((i=e.pedidoForm.get("talla"))==null?null:i.invalid)&&((i=e.pedidoForm.get("talla"))==null?null:i.touched))}}function me(d,t){d&1&&(o(0,"div",43),r(1," Ingrese una cantidad v\xE1lida (m\xEDnimo 1). "),n())}function ge(d,t){d&1&&(o(0,"div",43),r(1," La fecha y hora de entrega son obligatorias. "),n())}function fe(d,t){d&1&&(o(0,"div",43),r(1," El nombre del cliente es obligatorio. "),n())}function _e(d,t){if(d&1&&(o(0,"div",49),r(1),n()),d&2){let i=m();l(),x(" ",i.successMessage," ")}}function be(d,t){if(d&1&&(o(0,"div",50),r(1),n()),d&2){let i=m();l(),x(" ",i.errorMessage," ")}}var oe=class d{fb=P(ee);productionService=P(ie);productoService=P(ne);router=P(j);submitting=!1;successMessage="";errorMessage="";productos$;familias$;filteredProductos$;allProductos=[];selectedProducto=null;selectedFamiliaBS=new T(null);selectedFamilia$=this.selectedFamiliaBS.asObservable();searchControl=new G("");pedidoForm=this.fb.group({productoBase:["",_.required],talla:[""],cantidad:[1,[_.required,_.min(1)]],fechaEntrega:[this.getDefaultDate(),_.required],estado:["Pendiente"],nombreCliente:["",_.required],notasPastelero:[""],notasTienda:[""]});getDefaultDate(){let t=new Date;return t.setDate(t.getDate()+1),`${t.toISOString().split("T")[0]}T09:30`}ngOnInit(){this.productos$=this.productoService.getProductos().pipe(A(t=>this.allProductos=t)),this.familias$=this.productos$.pipe(F(t=>[...new Set(t.map(i=>i.familia))].sort())),this.filteredProductos$=O([this.productos$,this.searchControl.valueChanges.pipe(M("")),this.selectedFamilia$]).pipe(F(([t,i,e])=>{let a=(i||"").toLowerCase();return t.filter(c=>{let g=c.producto.toLowerCase().includes(a)||c.familia.toLowerCase().includes(a),f=!e||c.familia===e;return g&&f})}))}selectFamilia(t){this.selectedFamiliaBS.next(t),this.selectedProducto||this.searchControl.setValue("",{emitEvent:!0})}selectProducto(t){this.selectedProducto=t,this.pedidoForm.get("productoBase")?.setValue(t.id),this.searchControl.setValue(t.producto,{emitEvent:!1}),this.selectedProducto?.tallasRaciones?.length?this.pedidoForm.get("talla")?.setValidators(_.required):(this.pedidoForm.get("talla")?.clearValidators(),this.pedidoForm.get("talla")?.setValue("")),this.pedidoForm.get("talla")?.updateValueAndValidity()}onProductoChange(){let t=this.pedidoForm.get("productoBase")?.value;this.selectedProducto=this.allProductos.find(i=>i.id===t)||null,this.selectedProducto?.tallasRaciones?.length?this.pedidoForm.get("talla")?.setValidators(_.required):(this.pedidoForm.get("talla")?.clearValidators(),this.pedidoForm.get("talla")?.setValue("")),this.pedidoForm.get("talla")?.updateValueAndValidity()}adjustQuantity(t){let i=this.pedidoForm.get("cantidad")?.value||0,e=Math.max(1,i+t);this.pedidoForm.get("cantidad")?.setValue(e)}setQuickDate(t){let i=this.pedidoForm.get("fechaEntrega")?.value||"",e=i.includes("T")?i.split("T")[1]:"09:30",a=new Date;a.setDate(a.getDate()+t);let c=a.toISOString().split("T")[0];this.pedidoForm.get("fechaEntrega")?.setValue(`${c}T${e}`)}setNextDay(t){let i=this.pedidoForm.get("fechaEntrega")?.value||"",e=i.includes("T")?i.split("T")[1]:"09:30",a=new Date,c=a.getDay(),g=(t-c+7)%7;a.setDate(a.getDate()+g);let f=a.toISOString().split("T")[0];this.pedidoForm.get("fechaEntrega")?.setValue(`${f}T${e}`)}setQuickTime(t){let i=this.pedidoForm.get("fechaEntrega")?.value||"",e=i.includes("T")?i.split("T")[0]:new Date().toISOString().split("T")[0];this.pedidoForm.get("fechaEntrega")?.setValue(`${e}T${t}`)}onSubmit(){if(this.pedidoForm.invalid||!this.selectedProducto)return;this.submitting=!0,this.errorMessage="";let t=this.pedidoForm.value,e={producto:this.selectedProducto.producto+(t.talla?` (${t.talla})`:""),cantidad:t.cantidad,fechaEntrega:t.fechaEntrega,estado:t.estado,nombreCliente:t.nombreCliente,notasPastelero:t.notasPastelero,notasTienda:t.notasTienda};this.productionService.addPedido(e).subscribe({next:()=>{this.successMessage="Pedido guardado correctamente. Redirigiendo...",setTimeout(()=>this.router.navigate(["/pedidos"]),2e3)},error:a=>{this.errorMessage=a.message,this.submitting=!1}})}static \u0275fac=function(i){return new(i||d)};static \u0275cmp=V({type:d,selectors:[["app-add-pedido"]],standalone:!0,features:[D],decls:78,vars:22,consts:[[1,"form-container"],[3,"ngSubmit","formGroup"],[1,"form-group"],[1,"family-shortcuts"],["type","button",1,"btn-shortcut",3,"click"],["type","button","class","btn-shortcut",3,"active","click",4,"ngFor","ngForOf"],["for","productoSearch"],[1,"search-container"],["id","productoSearch","type","text","placeholder","Escribe para buscar (ej: tarta, pan...)","autocomplete","off",3,"formControl"],["class","product-results",4,"ngIf"],["class","selected-badge",4,"ngIf"],["class","error",4,"ngIf"],["class","form-group",4,"ngIf"],["for","cantidad"],[1,"quantity-controls"],["type","button",1,"btn-qty",3,"click"],["id","cantidad","type","number","formControlName","cantidad"],["for","fechaEntrega"],[1,"date-shortcuts"],[1,"time-shortcuts"],["type","button","title","Primera hora",1,"btn-shortcut",3,"click"],["type","button","title","Media ma\xF1ana",1,"btn-shortcut",3,"click"],["type","button","title","Mediod\xEDa",1,"btn-shortcut",3,"click"],["type","button","title","1\xAA Tarde",1,"btn-shortcut",3,"click"],["type","button","title","2\xAA Tarde",1,"btn-shortcut",3,"click"],["id","fechaEntrega","type","datetime-local","formControlName","fechaEntrega"],["for","nombreCliente"],["id","nombreCliente","type","text","formControlName","nombreCliente","placeholder","Ej: Juan P\xE9rez"],["for","notasPastelero"],["id","notasPastelero","formControlName","notasPastelero","placeholder","Ej: Sin lactosa, mensaje 'Felicidades'..."],["for","notasTienda"],["id","notasTienda","formControlName","notasTienda","placeholder","Ej: Paga al recoger..."],[1,"actions"],["type","button","routerLink","/pedidos",1,"btn-secondary"],["type","submit",1,"btn-primary",3,"disabled"],["class","success-alert",4,"ngIf"],["class","error-alert",4,"ngIf"],[1,"product-results"],["class","product-item",3,"click",4,"ngFor","ngForOf"],[1,"product-item",3,"click"],[1,"family-tag"],[1,"selected-badge"],["type","button",1,"btn-clear",3,"click"],[1,"error"],["for","talla"],["id","talla","formControlName","talla"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"success-alert"],[1,"error-alert"]],template:function(i,e){if(i&1&&(o(0,"div",0)(1,"h2"),r(2,"A\xF1adir Nuevo Pedido"),n(),o(3,"form",1),u("ngSubmit",function(){return e.onSubmit()}),o(4,"div",2)(5,"label"),r(6,"Familias de Productos"),n(),o(7,"div",3)(8,"button",4),v(9,"async"),u("click",function(){return e.selectFamilia(null)}),r(10,"TODOS"),n(),p(11,re,3,5,"button",5),v(12,"async"),n()(),o(13,"div",2)(14,"label",6),r(15,"Buscar Producto"),n(),o(16,"div",7),b(17,"input",8),p(18,de,3,3,"div",9),v(19,"async"),n(),p(20,le,6,2,"div",10)(21,ce,2,0,"div",11),n(),p(22,pe,8,2,"div",12),o(23,"div",2)(24,"label",13),r(25,"Cantidad"),n(),o(26,"div",14)(27,"button",15),u("click",function(){return e.adjustQuantity(-1)}),r(28,"-"),n(),b(29,"input",16),o(30,"button",15),u("click",function(){return e.adjustQuantity(1)}),r(31,"+"),n()(),p(32,me,2,0,"div",11),n(),o(33,"div",2)(34,"label",17),r(35,"Fecha de Entrega"),n(),o(36,"div",18)(37,"button",4),u("click",function(){return e.setQuickDate(0)}),r(38,"Hoy"),n(),o(39,"button",4),u("click",function(){return e.setQuickDate(1)}),r(40,"Ma\xF1ana"),n(),o(41,"button",4),u("click",function(){return e.setNextDay(6)}),r(42,"S\xE1bado"),n(),o(43,"button",4),u("click",function(){return e.setNextDay(0)}),r(44,"Domingo"),n()(),o(45,"div",19)(46,"button",20),u("click",function(){return e.setQuickTime("08:00")}),r(47,"08:00"),n(),o(48,"button",21),u("click",function(){return e.setQuickTime("11:00")}),r(49,"11:00"),n(),o(50,"button",22),u("click",function(){return e.setQuickTime("13:00")}),r(51,"13:00"),n(),o(52,"button",23),u("click",function(){return e.setQuickTime("16:30")}),r(53,"16:30"),n(),o(54,"button",24),u("click",function(){return e.setQuickTime("19:00")}),r(55,"19:00"),n()(),b(56,"input",25),p(57,ge,2,0,"div",11),n(),o(58,"div",2)(59,"label",26),r(60,"Nombre Cliente"),n(),b(61,"input",27),p(62,fe,2,0,"div",11),n(),o(63,"div",2)(64,"label",28),r(65,"Notas para Pastelero (Opcional)"),n(),b(66,"textarea",29),n(),o(67,"div",2)(68,"label",30),r(69,"Notas para Tienda (Opcional)"),n(),b(70,"textarea",31),n(),o(71,"div",32)(72,"button",33),r(73,"Cancelar"),n(),o(74,"button",34),r(75),n()()(),p(76,_e,2,1,"div",35)(77,be,2,1,"div",36),n()),i&2){let a,c,g,f;l(3),s("formGroup",e.pedidoForm),l(5),k("active",h(9,16,e.selectedFamilia$)===null),l(3),s("ngForOf",h(12,18,e.familias$)),l(6),s("formControl",e.searchControl),l(),s("ngIf",(e.searchControl.value||h(19,20,e.selectedFamilia$))&&!e.selectedProducto),l(2),s("ngIf",e.selectedProducto),l(),s("ngIf",((a=e.pedidoForm.get("productoBase"))==null?null:a.invalid)&&((a=e.pedidoForm.get("productoBase"))==null?null:a.touched)),l(),s("ngIf",e.selectedProducto==null||e.selectedProducto.tallasRaciones==null?null:e.selectedProducto.tallasRaciones.length),l(10),s("ngIf",((c=e.pedidoForm.get("cantidad"))==null?null:c.invalid)&&((c=e.pedidoForm.get("cantidad"))==null?null:c.touched)),l(25),s("ngIf",((g=e.pedidoForm.get("fechaEntrega"))==null?null:g.invalid)&&((g=e.pedidoForm.get("fechaEntrega"))==null?null:g.touched)),l(5),s("ngIf",((f=e.pedidoForm.get("nombreCliente"))==null?null:f.invalid)&&((f=e.pedidoForm.get("nombreCliente"))==null?null:f.touched)),l(12),s("disabled",e.pedidoForm.invalid||e.submitting),l(),x(" ",e.submitting?"Guardando...":"Guardar Pedido"," "),l(),s("ngIf",e.successMessage),l(),s("ngIf",e.errorMessage)}},dependencies:[B,I,$,N,te,H,Y,Z,q,J,X,R,L,W,K,U,Q,z],styles:[".form-container[_ngcontent-%COMP%]{max-width:500px;margin:20px auto;padding:20px;border:1px solid #ddd;border-radius:8px;background:#fff}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;font-size:1rem}.search-container[_ngcontent-%COMP%]{position:relative}.product-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-top:none;z-index:10;max-height:200px;overflow-y:auto;box-shadow:0 4px 6px #0000001a}.product-item[_ngcontent-%COMP%]{padding:10px;cursor:pointer;border-bottom:1px solid #eee}.product-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.family-tag[_ngcontent-%COMP%]{font-size:.7rem;background:#eee;padding:2px 5px;border-radius:4px;margin-right:5px;text-transform:uppercase;color:#666}.family-shortcuts[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:5px}.family-shortcuts[_ngcontent-%COMP%]   .btn-shortcut.active[_ngcontent-%COMP%]{background:#d35400;color:#fff;border-color:#d35400}.selected-badge[_ngcontent-%COMP%]{margin-top:5px;padding:8px 12px;background:#e8f4fd;border:1px solid #b8daff;border-radius:4px;display:flex;justify-content:space-between;align-items:center;font-size:.9rem}.btn-clear[_ngcontent-%COMP%]{background:none;border:none;font-size:1.2rem;cursor:pointer;color:#dc3545}.quantity-controls[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.quantity-controls[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;font-weight:700}.btn-qty[_ngcontent-%COMP%]{background:#34495e;color:#fff;border:none;width:40px;height:40px;border-radius:4px;font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center}textarea[_ngcontent-%COMP%]{min-height:80px;resize:vertical}.error[_ngcontent-%COMP%]{color:red;font-size:.8rem;margin-top:4px}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:20px}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:4px;cursor:pointer;border:none}.btn-primary[_ngcontent-%COMP%]{background:#d35400;color:#fff}.btn-primary[_ngcontent-%COMP%]:disabled{background:#ccc}.btn-secondary[_ngcontent-%COMP%]{background:#eee}.date-shortcuts[_ngcontent-%COMP%], .time-shortcuts[_ngcontent-%COMP%]{display:flex;gap:5px;margin-bottom:5px;overflow-x:auto;padding-bottom:5px}.btn-shortcut[_ngcontent-%COMP%]{background:#f4f4f4;border:1px solid #ddd;padding:5px 10px;border-radius:4px;font-size:.85rem;white-space:nowrap;cursor:pointer}.btn-shortcut[_ngcontent-%COMP%]:hover{background:#e9ecef}.btn-shortcut[_ngcontent-%COMP%]:active{background:#dee2e6}.success-alert[_ngcontent-%COMP%]{margin-top:15px;padding:10px;background:#d4edda;color:#155724;border-radius:4px}.error-alert[_ngcontent-%COMP%]{margin-top:15px;padding:10px;background:#f8d7da;color:#721c24;border-radius:4px}"]})};export{oe as AddPedidoComponent};
