import{a as v,b as P}from"./chunk-ORCUSZZD.js";import{I as f,a as s,b as d,d as h,g as c,h as a,k as p,q as l,t as u,ta as m,ua as b}from"./chunk-ALWVHIEC.js";var g=class i{http=u(b);adapter=u(v);apiUrl=P.apiUrl;productosState=new h([]);productosSignal=f([]);loaded=!1;constructor(){this.productosState.subscribe(t=>this.productosSignal.set(t))}getProductos(){return this.loaded||this.refreshProductos().subscribe(),this.productosState.asObservable()}refreshProductos(){return this.http.get(`${this.apiUrl}?type=productos`).pipe(a(t=>{if(t.status==="error")throw new Error(t.message);let r=this.adapter.adaptProductos(t);return this.productosState.next(r),this.loaded=!0,r}),p(t=>(console.error("Error fetching productos:",t),c(()=>new Error("No se pudieron cargar los productos.")))))}getProductoById(t){return this.getProductos().pipe(a(r=>r.find(o=>o.id===t)))}addProducto(t){let r=crypto.randomUUID(),o=d(s({},t),{id:r}),n=this.productosState.value;this.productosState.next([...n,o]);let S=d(s({},this.adapter.prepareProductoForPost(o)),{action:"addProduct"});return this.http.post(this.apiUrl,JSON.stringify(S),{headers:new m({"Content-Type":"text/plain;charset=utf-8"})}).pipe(a(e=>{if(e.status==="error")throw new Error(e.message);return e}),p(e=>(this.productosState.next(n),c(()=>new Error("Error al a\xF1adir. Se ha revertido el cambio.")))))}static \u0275fac=function(r){return new(r||i)};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{g as a};
