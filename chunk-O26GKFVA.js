import{a as K}from"./chunk-T6BMFCRC.js";import{a as j,c as Y,e as M,h as q,k as W,l as G,m as Z,o as J}from"./chunk-F5WL7XU5.js";import{a as Q}from"./chunk-LIV6L26T.js";import"./chunk-ORCUSZZD.js";import{Aa as B,Da as U,F as a,K as x,M as s,N as C,P as i,Q as o,R as y,U as v,V as f,W as l,X as D,Y as d,Z as _,_ as h,ba as V,ca as $,d as k,da as b,ea as O,fa as S,ga as z,h as P,i as I,l as E,m as T,oa as A,pa as L,qa as H,ra as R,sa as N,t as w,u as F,y as g,z as u}from"./chunk-ALWVHIEC.js";var te=r=>["/obrador/pedidos",r];function ne(r,t){if(r&1&&(i(0,"option",18),d(1),o()),r&2){let e=t.$implicit;s("value",e),a(),_(e)}}function ie(r,t){if(r&1){let e=v();i(0,"div",21)(1,"button",22),f("click",function(){g(e);let c=l();return u(c.toggleStatus("Pendiente"))}),d(2," Falta "),i(3,"span",23),d(4),o()(),i(5,"button",22),f("click",function(){g(e);let c=l();return u(c.toggleStatus("En Proceso"))}),d(6," En curso "),i(7,"span",23),d(8),o()(),i(9,"button",22),f("click",function(){g(e);let c=l();return u(c.toggleStatus("Producido"))}),d(10," Terminado "),i(11,"span",23),d(12),o()()()}if(r&2){let e=t.ngIf,n=l();a(),C("active",n.isStatusActive("Pendiente")),a(3),_(e.falta),a(),C("active",n.isStatusActive("En Proceso")),a(3),_(e.enCurso),a(),C("active",n.isStatusActive("Producido")),a(3),_(e.terminado)}}function oe(r,t){if(r&1){let e=v();i(0,"div",31),f("click",function(){let c=g(e).$implicit,p=l(3);return u(p.setFechaToPedido(c))}),i(1,"span",32),d(2),b(3,"date"),o(),i(4,"span",33),d(5),o(),i(6,"span",34),d(7),o()()}if(r&2){let e=t.$implicit;a(2),_(S(3,3,e.fechaEntrega,"HH:mm")),a(3),_(e.producto),a(2),h("",e.cantidad,"u.")}}function re(r,t){if(r&1&&(i(0,"div",29),x(1,oe,8,6,"div",30),o()),r&2){let e=l().ngIf;a(),s("ngForOf",e)}}function ae(r,t){if(r&1){let e=v();i(0,"div",24)(1,"div",25),f("click",function(){g(e);let c=l();return u(c.showUpcomingList=!c.showUpcomingList)}),i(2,"span",26),d(3,"\u26A0\uFE0F"),o(),i(4,"h3"),d(5),o(),i(6,"span",27),d(7),o()(),x(8,re,2,1,"div",28),o()}if(r&2){let e=t.ngIf,n=l();a(5),h("Pedidos pr\xF3ximos sin empezar (",e.length,")"),a(2),_(n.showUpcomingList?"\u25BC":"\u25B6"),a(),s("ngIf",n.showUpcomingList&&e.length>0)}}function de(r,t){if(r&1&&(i(0,"div",51),d(1),o()),r&2){let e=l().$implicit;a(),_(e.nombreCliente)}}function ce(r,t){if(r&1&&(i(0,"div",52)(1,"strong"),d(2,"NOTA:"),o(),d(3),o()),r&2){let e=l().$implicit;a(3),h(" ",e.notasPastelero," ")}}function se(r,t){if(r&1){let e=v();i(0,"button",53),f("click",function(){g(e);let c=l().$implicit,p=l(2);return u(p.updateStatus(c.id,"En Proceso"))}),d(1),o()}if(r&2){let e=l().$implicit,n=l(2);s("disabled",n.updatingId===e.id),a(),h(" ",n.updatingId===e.id?"...":"EMPEZAR"," ")}}function le(r,t){if(r&1){let e=v();i(0,"button",54),f("click",function(){g(e);let c=l().$implicit,p=l(2);return u(p.updateStatus(c.id,"Producido"))}),d(1),o()}if(r&2){let e=l().$implicit,n=l(2);s("disabled",n.updatingId===e.id),a(),h(" ",n.updatingId===e.id?"...":"TERMINAR"," ")}}function pe(r,t){r&1&&(i(0,"span",55),d(1,"PRODUCIDO \u2713"),o())}function me(r,t){r&1&&(i(0,"span",55),d(1,"ENTREGADO \u2713"),o())}function ge(r,t){if(r&1&&(i(0,"div",38)(1,"div",39)(2,"span",32),d(3),b(4,"date"),o(),i(5,"span",40),d(6),b(7,"date"),o()(),i(8,"div",41)(9,"div",42),d(10),o(),i(11,"div",43),d(12),o(),x(13,de,2,1,"div",44)(14,ce,4,1,"div",45),o(),i(15,"div",46),x(16,se,2,2,"button",47)(17,le,2,2,"button",48)(18,pe,2,0,"span",49)(19,me,2,0,"span",49),i(20,"button",50),d(21," VER DETALLE "),o()()()),r&2){let e=t.$implicit,n=l(2);C("in-process",e.estado==="En Proceso")("urgent",n.isUrgent(e.fechaEntrega)),a(3),_(S(4,15,e.fechaEntrega,"HH:mm")),a(3),_(n.isToday(e.fechaEntrega)?"HOY":S(7,18,e.fechaEntrega,"dd/MM")),a(4),h("",e.cantidad,"u."),a(2),_(e.producto),a(),s("ngIf",e.nombreCliente),a(),s("ngIf",e.notasPastelero),a(2),s("ngIf",e.estado==="Pendiente"),a(),s("ngIf",e.estado==="En Proceso"),a(),s("ngIf",e.estado==="Producido"),a(),s("ngIf",e.estado==="Entregado"),a(),s("routerLink",$(21,te,e.id))}}function ue(r,t){r&1&&(i(0,"div",56),d(1," No hay productos pendientes de producir. "),o())}function fe(r,t){if(r&1&&(i(0,"div",35),x(1,ge,22,23,"div",36)(2,ue,2,0,"div",37),o()),r&2){let e=t.ngIf;a(),s("ngForOf",e),a(),s("ngIf",e.length===0)}}function _e(r,t){r&1&&(i(0,"div",57),d(1,"Cargando producci\xF3n..."),o())}var X=class r{productionService=w(K);productoService=w(Q);refresh$=new k(void 0);updatingId=null;isRefreshing=!0;upcomingThresholdHours=4;showUpcomingList=!0;activeStatuses=["Pendiente","En Proceso"];familiaFilter=new M("");fechaFilter=new M(this.formatDate(new Date));familias$;filteredPedidos$;upcomingPedidos$;counts$;constructor(){this.familias$=this.productoService.getProductos().pipe(P(t=>[...new Set(t.map(e=>e.familia))].sort()))}ngOnInit(){let t=this.refresh$.pipe(T(()=>this.productionService.getPedidos())),e=I([t,this.familiaFilter.valueChanges.pipe(E(this.familiaFilter.value)),this.fechaFilter.valueChanges.pipe(E(this.fechaFilter.value))]).pipe(P(([n,c,p])=>n.filter(m=>!c||m.producto.startsWith(c)||this.belongsToFamilia(m,c)).filter(m=>!p||this.formatDate(m.fechaEntrega)===p)));this.filteredPedidos$=e.pipe(P(n=>n.filter(c=>this.activeStatuses.length===0||this.activeStatuses.includes(c.estado)).sort((c,p)=>c.fechaEntrega.getTime()-p.fechaEntrega.getTime()))),this.upcomingPedidos$=t.pipe(P(n=>{let c=new Date,p=new Date(c.getTime()+this.upcomingThresholdHours*60*60*1e3);return n.filter(m=>m.estado==="Pendiente").filter(m=>m.fechaEntrega>c&&m.fechaEntrega<=p).sort((m,ee)=>m.fechaEntrega.getTime()-ee.fechaEntrega.getTime())})),this.counts$=e.pipe(P(n=>({falta:n.filter(c=>c.estado==="Pendiente").length,enCurso:n.filter(c=>c.estado==="En Proceso").length,terminado:n.filter(c=>c.estado==="Producido").length}))),setInterval(()=>this.refresh$.next(),3e4)}changeThreshold(t){this.upcomingThresholdHours=t,this.refresh$.next()}belongsToFamilia(t,e){return t.producto.toLowerCase().includes(e.toLowerCase())}isStatusActive(t){return this.activeStatuses.includes(t)}toggleStatus(t){this.activeStatuses.includes(t)?this.activeStatuses=this.activeStatuses.filter(e=>e!==t):this.activeStatuses=[...this.activeStatuses,t],this.refresh$.next()}changeDay(t){let e=this.fechaFilter.value;if(!e)return;let n=new Date(e);n.setDate(n.getDate()+t),this.fechaFilter.setValue(this.formatDate(n))}setToday(){this.fechaFilter.setValue(this.formatDate(new Date))}setFechaToPedido(t){this.fechaFilter.setValue(this.formatDate(t.fechaEntrega))}updateStatus(t,e){this.updatingId=t,this.productionService.updatePedidoStatus(t,e).subscribe({next:()=>{this.updatingId=null,this.refresh$.next()},error:n=>{alert(n.message),this.updatingId=null}})}formatDate(t){return t.toISOString().split("T")[0]}isToday(t){let e=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}isUrgent(t){if(!this.isToday(t))return!1;let e=new Date;return(t.getTime()-e.getTime())/(1e3*60*60)<3}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-pedidos-obrador"]],standalone:!0,features:[V],decls:50,vars:22,consts:[["loading",""],[1,"obrador-container"],[1,"header"],[1,"auto-refresh"],[1,"dot"],[1,"filters"],[1,"filter-group"],[3,"formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"date-nav"],["title","D\xEDa Anterior",1,"btn-nav",3,"click"],["type","date",3,"formControl"],["title","D\xEDa Siguiente",1,"btn-nav",3,"click"],[1,"btn-today",3,"click"],["class","filter-chips",4,"ngIf"],[1,"filter-group","settings"],[3,"change","value"],[3,"value"],["class","alerts-section",4,"ngIf"],["class","production-grid",4,"ngIf","ngIfElse"],[1,"filter-chips"],[1,"chip",3,"click"],[1,"count"],[1,"alerts-section"],[1,"alert-header",3,"click"],[1,"alert-icon"],[1,"chevron"],["class","upcoming-scroll",4,"ngIf"],[1,"upcoming-scroll"],["class","upcoming-mini-card",3,"click",4,"ngFor","ngForOf"],[1,"upcoming-mini-card",3,"click"],[1,"time"],[1,"name"],[1,"qty"],[1,"production-grid"],["class","order-card",3,"in-process","urgent",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"order-card"],[1,"card-header"],[1,"delivery-date"],[1,"card-body"],[1,"quantity"],[1,"product-name"],["class","client-name",4,"ngIf"],["class","baker-notes",4,"ngIf"],[1,"card-actions"],["class","btn-start",3,"disabled","click",4,"ngIf"],["class","btn-finish",3,"disabled","click",4,"ngIf"],["class","badge-done",4,"ngIf"],[1,"btn-view-order",3,"routerLink"],[1,"client-name"],[1,"baker-notes"],[1,"btn-start",3,"click","disabled"],[1,"btn-finish",3,"click","disabled"],[1,"badge-done"],[1,"empty-state"],[1,"loading-state"]],template:function(e,n){if(e&1){let c=v();i(0,"div",1)(1,"div",2)(2,"h2"),d(3,"Producci\xF3n de Obrador"),o(),i(4,"div",3),y(5,"span",4),d(6," Auto-actualizando cada 30s "),o()(),i(7,"div",5)(8,"div",6)(9,"label"),d(10,"Familia:"),o(),i(11,"select",7)(12,"option",8),d(13,"Todas las familias"),o(),x(14,ne,2,2,"option",9),b(15,"async"),o()(),i(16,"div",6)(17,"label"),d(18,"Fecha:"),o(),i(19,"div",10)(20,"button",11),f("click",function(){return g(c),u(n.changeDay(-1))}),d(21,"\u2039"),o(),y(22,"input",12),i(23,"button",13),f("click",function(){return g(c),u(n.changeDay(1))}),d(24,"\u203A"),o(),i(25,"button",14),f("click",function(){return g(c),u(n.setToday())}),d(26,"HOY"),o()()(),i(27,"div",6)(28,"label"),d(29,"Estados:"),o(),x(30,ie,13,9,"div",15),b(31,"async"),o(),i(32,"div",16)(33,"label"),d(34,"Alerta Pr\xF3ximos:"),o(),i(35,"select",17),f("change",function(m){return g(c),u(n.changeThreshold(+m.target.value))}),i(36,"option",18),d(37,"Siguientes 2h"),o(),i(38,"option",18),d(39,"Siguientes 4h"),o(),i(40,"option",18),d(41,"Siguientes 8h"),o(),i(42,"option",18),d(43,"Ma\xF1ana (24h)"),o()()()(),x(44,ae,9,3,"div",19),b(45,"async"),x(46,fe,3,2,"div",20),b(47,"async"),x(48,_e,2,0,"ng-template",null,0,z),o()}if(e&2){let c=D(49);a(5),C("active",n.isRefreshing),a(6),s("formControl",n.familiaFilter),a(3),s("ngForOf",O(15,14,n.familias$)),a(8),s("formControl",n.fechaFilter),a(8),s("ngIf",O(31,16,n.counts$)),a(5),s("value",n.upcomingThresholdHours),a(),s("value",2),a(2),s("value",4),a(2),s("value",8),a(2),s("value",24),a(2),s("ngIf",O(45,18,n.upcomingPedidos$)),a(2),s("ngIf",O(47,20,n.filteredPedidos$))("ngIfElse",c)}},dependencies:[N,A,L,H,R,J,G,Z,j,W,Y,q,U,B],styles:[".obrador-container[_ngcontent-%COMP%]{padding:20px;background:#f0f2f5;min-height:100vh}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.auto-refresh[_ngcontent-%COMP%]{font-size:.8rem;color:#666;display:flex;align-items:center;gap:8px}.dot[_ngcontent-%COMP%]{width:8px;height:8px;background:#ccc;border-radius:50%}.dot.active[_ngcontent-%COMP%]{background:#2ecc71;box-shadow:0 0 5px #2ecc71;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.4}to{opacity:1}}.filters[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:25px;align-items:flex-end}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem}.date-nav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;background:#fff;padding:4px;border-radius:8px;border:1px solid #ddd}.date-nav[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;padding:6px;font-weight:700;outline:none}.btn-nav[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;padding:4px 12px;cursor:pointer;font-size:1.2rem;color:#495057;display:flex;align-items:center;justify-content:center}.btn-nav[_ngcontent-%COMP%]:hover{background:#e9ecef}.btn-today[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;border:none;padding:6px 12px;border-radius:4px;font-weight:700;font-size:.8rem;cursor:pointer;margin-left:5px}.btn-today[_ngcontent-%COMP%]:hover{background:#bbdefb}select[_ngcontent-%COMP%]{padding:10px;border-radius:6px;border:1px solid #ddd;min-width:150px}.filter-chips[_ngcontent-%COMP%]{display:flex;gap:8px}.chip[_ngcontent-%COMP%]{padding:8px 16px;border:1px solid #ddd;background:#fff;border-radius:20px;cursor:pointer;font-size:.9rem;color:#666;transition:all .2s;width:auto}.chip[_ngcontent-%COMP%]:hover{background:#f8f9fa}.chip.active[_ngcontent-%COMP%]{background:#34495e;color:#fff;border-color:#34495e}.chip[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{background:#eee;color:#777;padding:1px 6px;border-radius:10px;font-size:.75rem;margin-left:5px;font-weight:700}.chip.active[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{background:#fff3;color:#fff}.alerts-section[_ngcontent-%COMP%]{background:#fff5f5;border:1px solid #feb2b2;border-radius:12px;margin-bottom:25px;overflow:hidden}.alert-header[_ngcontent-%COMP%]{padding:12px 20px;display:flex;align-items:center;gap:12px;cursor:pointer;background:#fff5f5}.alert-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1rem;color:#c53030;flex-grow:1}.alert-icon[_ngcontent-%COMP%]{font-size:1.2rem}.chevron[_ngcontent-%COMP%]{color:#c53030;font-size:.8rem}.upcoming-scroll[_ngcontent-%COMP%]{display:flex;gap:12px;padding:0 15px 15px;overflow-x:auto;scroll-behavior:smooth}.upcoming-mini-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #feb2b2;border-left:4px solid #f56565;padding:10px 15px;border-radius:8px;min-width:200px;display:flex;flex-direction:column;gap:2px;cursor:pointer;transition:background .2s}.upcoming-mini-card[_ngcontent-%COMP%]:hover{background:#fffaf0}.upcoming-mini-card[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-weight:900;color:#c53030;font-size:1.1rem}.upcoming-mini-card[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#2d3748;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.upcoming-mini-card[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{font-size:.8rem;color:#718096}.production-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}.order-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px #0000000d;overflow:hidden;display:flex;flex-direction:column;border-top:6px solid #95a5a6;transition:transform .2s}.order-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.order-card.in-process[_ngcontent-%COMP%]{border-top-color:#3498db;background:#ebf5fb}.order-card.urgent[_ngcontent-%COMP%]{border-top-color:#e74c3c}.card-header[_ngcontent-%COMP%]{padding:10px 15px;display:flex;justify-content:space-between;align-items:center;background:#00000005;border-bottom:1px solid #eee}.time[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#2c3e50}.delivery-date[_ngcontent-%COMP%]{font-weight:700;color:#7f8c8d;font-size:.9rem}.card-body[_ngcontent-%COMP%]{padding:15px;flex-grow:1}.quantity[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:800;color:#d35400;line-height:1;margin-bottom:5px}.product-name[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#2c3e50;margin-bottom:2px}.client-name[_ngcontent-%COMP%]{font-size:.9rem;color:#7f8c8d;margin-bottom:10px;font-style:italic}.baker-notes[_ngcontent-%COMP%]{background:#fff9c4;padding:10px;border-radius:6px;font-size:.95rem;color:#856404;border-left:4px solid #fbc02d}.card-actions[_ngcontent-%COMP%]{padding:15px;border-top:1px solid #eee}button[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:1rem}.btn-start[_ngcontent-%COMP%]{background:#3498db;color:#fff}.btn-finish[_ngcontent-%COMP%]{background:#2ecc71;color:#fff}.btn-view-order[_ngcontent-%COMP%]{background:none;color:#7f8c8d;border:1px solid #ddd;margin-top:10px;font-size:.8rem;padding:8px}.btn-view-order[_ngcontent-%COMP%]:hover{background:#f9f9f9;color:#2c3e50;border-color:#bdc3c7}.badge-done[_ngcontent-%COMP%]{color:#27ae60;font-weight:700;display:block;text-align:center}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{grid-column:1/-1;padding:50px;text-align:center;background:#fff;border-radius:12px;color:#666}"]})};export{X as PedidosObradorComponent};
