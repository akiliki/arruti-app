import{a as re}from"./chunk-VYVNSZGR.js";import{a as X,c as Z,e as v,h as ee,k as te,l as ne,m as ie,o as oe}from"./chunk-J4TYNHYF.js";import"./chunk-EAY7Z6F7.js";import{$ as h,D as a,I as g,J as z,K as l,L as A,N as n,O as t,P as C,Q as R,R as V,S as p,T as y,U as i,V as m,W as _,Z as q,_ as H,aa as O,ba as B,ca as S,d as k,h as E,i as F,ja as j,ka as Y,l as b,la as G,m as T,ma as W,na as J,oa as K,t as L,u as $,wa as Q,y as D,z as N,za as U}from"./chunk-II2SJXWV.js";var ce=r=>["/pedidos",r];function pe(r,o){if(r&1&&(n(0,"div",18)(1,"div",19)(2,"span",20),i(3),t(),n(4,"span",21),i(5,"Pendientes de Entregar"),t()(),n(6,"div",22)(7,"span",20),i(8),t(),n(9,"span",21),i(10,"Para Hoy"),t()(),n(11,"div",23)(12,"span",20),i(13),t(),n(14,"span",21),i(15,"En Obrador"),t()(),n(16,"div",24)(17,"span",20),i(18),t(),n(19,"span",21),i(20,"Entregados Hoy"),t()()()),r&2){let e=o.ngIf;a(3),m(e.pendientesEntrega),a(5),m(e.hoy),a(5),m(e.enObrador),a(5),m(e.entregados)}}function me(r,o){if(r&1&&(n(0,"div",36),i(1),t()),r&2){let e=p().$implicit;a(),_("Past: ",e.notasPastelero,"")}}function ge(r,o){if(r&1&&(n(0,"div",37),i(1),t()),r&2){let e=p().$implicit;a(),_("Tnd: ",e.notasTienda,"")}}function fe(r,o){r&1&&(n(0,"span"),i(1,"-"),t())}function ue(r,o){if(r&1){let e=R();n(0,"button",38),V("click",function(){D(e);let f=p().$implicit,P=p(3);return N(P.markAsDelivered(f.id))}),i(1),t()}if(r&2){let e=p().$implicit,d=p(3);l("disabled",d.updatingId===e.id),a(),_(" ",d.updatingId===e.id?"...":"ENTREGAR"," ")}}function xe(r,o){if(r&1&&(n(0,"tr")(1,"td",28),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),g(6,me,2,1,"div",29)(7,ge,2,1,"div",30)(8,fe,2,0,"span",31),t(),n(9,"td"),i(10),t(),n(11,"td"),i(12),h(13,"date"),t(),n(14,"td")(15,"span",32),i(16),t()(),n(17,"td")(18,"div",33)(19,"button",34),i(20," VER "),t(),g(21,ue,2,2,"button",35),t()()()),r&2){let e=o.$implicit,d=p(3);A("is-today",d.isToday(e.fechaEntrega))("is-urgent",d.isToday(e.fechaEntrega)&&e.estado==="Pendiente"),z("data-testid","pedido-row-"+e.id),a(2),m(e.nombreCliente||"-"),a(2),m(e.producto),a(2),l("ngIf",e.notasPastelero),a(),l("ngIf",e.notasTienda),a(),l("ngIf",!e.notasPastelero&&!e.notasTienda),a(2),m(e.cantidad),a(2),m(B(13,16,e.fechaEntrega,"dd/MM/yyyy HH:mm")),a(3),l("ngClass",e.estado.toLowerCase().replace(" ","-")),a(),_(" ",e.estado," "),a(3),l("routerLink",H(19,ce,e.id)),a(2),l("ngIf",e.estado==="Producido")}}function be(r,o){if(r&1&&(n(0,"table")(1,"thead")(2,"tr")(3,"th"),i(4,"Cliente"),t(),n(5,"th"),i(6,"Producto"),t(),n(7,"th"),i(8,"Notas"),t(),n(9,"th"),i(10,"Cantidad"),t(),n(11,"th"),i(12,"Fecha Entrega"),t(),n(13,"th"),i(14,"Estado"),t(),n(15,"th"),i(16,"Acciones"),t()()(),n(17,"tbody"),g(18,xe,22,21,"tr",27),t()()),r&2){let e=p().ngIf;a(18),l("ngForOf",e)}}function _e(r,o){r&1&&(n(0,"div",39),i(1,"No se encontraron pedidos con los filtros seleccionados."),t())}function ve(r,o){if(r&1&&(n(0,"div",25),g(1,be,19,1,"table",26)(2,_e,2,0,"ng-template",null,1,S),t()),r&2){let e=o.ngIf,d=y(3);a(),l("ngIf",e.length>0)("ngIfElse",d)}}function Ce(r,o){r&1&&(n(0,"div",40),i(1,"Cargando pedidos..."),t())}var ae=class r{productionService=L(re);estadoFilter=new v("");productoFilter=new v("");fechaFilter=new v(this.formatDate(new Date));nombreFilter=new v("");refresh$=new k(void 0);updatingId=null;filteredPedidos$;stats$;ngOnInit(){let o=this.refresh$.pipe(T(()=>this.productionService.getPedidos()));this.stats$=o.pipe(E(u=>({pendientesEntrega:u.filter(s=>s.estado!=="Entregado").length,hoy:u.filter(s=>this.isToday(s.fechaEntrega)).length,enObrador:u.filter(s=>s.estado==="Pendiente"||s.estado==="En Proceso").length,entregados:u.filter(s=>s.estado==="Entregado"&&this.isToday(s.fechaActualizacion||new Date)).length})));let e=this.estadoFilter.valueChanges.pipe(b(this.estadoFilter.value)),d=this.productoFilter.valueChanges.pipe(b(this.productoFilter.value)),f=this.fechaFilter.valueChanges.pipe(b(this.fechaFilter.value)),P=this.nombreFilter.valueChanges.pipe(b(this.nombreFilter.value));this.filteredPedidos$=F([o,e,d,f,P]).pipe(E(([u,s,M,I,w])=>u.filter(c=>{let x=!0;s==="Pendiente"?x=c.estado!=="Entregado":s?x=c.estado===s:x=c.estado!=="Entregado";let de=!M||c.producto.toLowerCase().includes(M.toLowerCase()),le=!I||this.formatDate(c.fechaEntrega)===I,se=!w||c.nombreCliente&&c.nombreCliente.toLowerCase().includes(w.toLowerCase());return x&&de&&le&&se}).sort((c,x)=>c.fechaEntrega.getTime()-x.fechaEntrega.getTime())))}isToday(o){let e=new Date;return o.getDate()===e.getDate()&&o.getMonth()===e.getMonth()&&o.getFullYear()===e.getFullYear()}markAsReady(o){this.updatingId=o,this.productionService.updatePedidoStatus(o,"Producido").subscribe({next:()=>{this.updatingId=null,this.refresh$.next()},error:e=>{alert("No se pudo actualizar: "+e.message),this.updatingId=null}})}markAsDelivered(o){this.updatingId=o,this.productionService.updatePedidoStatus(o,"Entregado").subscribe({next:()=>{this.updatingId=null,this.refresh$.next()},error:e=>{alert("No se pudo actualizar: "+e.message),this.updatingId=null}})}onStatusChange(o,e){let d=e.target.value;this.updatingId=o,this.productionService.updatePedidoStatus(o,d).subscribe({next:()=>{this.updatingId=null,this.refresh$.next()},error:f=>{alert(f.message),this.updatingId=null,this.refresh$.next()}})}formatDate(o){return o.toISOString().split("T")[0]}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=$({type:r,selectors:[["app-pedidos-list"]],standalone:!0,features:[q],decls:39,vars:11,consts:[["loading",""],["empty",""],[1,"list-container"],[1,"header"],["routerLink","/nuevo-pedido",1,"btn-new"],["class","summary-cards",4,"ngIf"],[1,"filters"],[1,"filter-group"],[3,"formControl"],["value",""],["value","Pendiente"],["value","En Proceso"],["value","Producido"],["value","Entregado"],["type","text","placeholder","Filtrar por producto...",3,"formControl"],["type","text","placeholder","Filtrar por cliente...",3,"formControl"],["type","date",3,"formControl"],["class","table-wrapper",4,"ngIf","ngIfElse"],[1,"summary-cards"],[1,"card","pending"],[1,"count"],[1,"label"],[1,"card","today"],[1,"card","manufacturing"],[1,"card","delivered"],[1,"table-wrapper"],[4,"ngIf","ngIfElse"],[3,"is-today","is-urgent",4,"ngFor","ngForOf"],[1,"client-name"],["class","note-tag pastelero",4,"ngIf"],["class","note-tag tienda",4,"ngIf"],[4,"ngIf"],[1,"badge",3,"ngClass"],[1,"action-buttons"],[1,"btn-action",3,"routerLink"],["class","btn-quick-ready",3,"disabled","click",4,"ngIf"],[1,"note-tag","pastelero"],[1,"note-tag","tienda"],[1,"btn-quick-ready",3,"click","disabled"],[1,"empty-state"],[1,"loading-state"]],template:function(e,d){if(e&1&&(n(0,"div",2)(1,"div",3)(2,"h2"),i(3,"Lista de Pedidos"),t(),n(4,"button",4),i(5,"Nuevo Pedido"),t()(),g(6,pe,21,4,"div",5),h(7,"async"),n(8,"div",6)(9,"div",7)(10,"label"),i(11,"Estado:"),t(),n(12,"select",8)(13,"option",9),i(14,"Todos"),t(),n(15,"option",10),i(16,"Pendiente"),t(),n(17,"option",11),i(18,"En Proceso"),t(),n(19,"option",12),i(20,"Producido"),t(),n(21,"option",13),i(22,"Entregado"),t()()(),n(23,"div",7)(24,"label"),i(25,"Producto:"),t(),C(26,"input",14),t(),n(27,"div",7)(28,"label"),i(29,"Nombre Cliente:"),t(),C(30,"input",15),t(),n(31,"div",7)(32,"label"),i(33,"Fecha:"),t(),C(34,"input",16),t()(),g(35,ve,4,2,"div",17),h(36,"async"),g(37,Ce,2,0,"ng-template",null,0,S),t()),e&2){let f=y(38);a(6),l("ngIf",O(7,7,d.stats$)),a(6),l("formControl",d.estadoFilter),a(14),l("formControl",d.productoFilter),a(4),l("formControl",d.nombreFilter),a(4),l("formControl",d.fechaFilter),a(),l("ngIf",O(36,9,d.filteredPedidos$))("ngIfElse",f)}},dependencies:[K,j,Y,G,W,J,oe,ne,ie,X,te,Z,ee,U,Q],styles:[".list-container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.btn-new[_ngcontent-%COMP%]{background:#d35400;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;font-weight:700}.summary-cards[_ngcontent-%COMP%]{display:flex;gap:15px;margin-bottom:20px}.card[_ngcontent-%COMP%]{flex:1;padding:15px;border-radius:8px;display:flex;flex-direction:column;align-items:center;background:#fff;border:1px solid #ddd}.card.pending[_ngcontent-%COMP%]{border-left:5px solid #2ecc71;background:#f0fff4}.card.today[_ngcontent-%COMP%]{border-left:5px solid #e74c3c;background:#fff5f5}.card.manufacturing[_ngcontent-%COMP%]{border-left:5px solid #3498db}.card.delivered[_ngcontent-%COMP%]{border-left:5px solid #95a5a6}.card[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.8rem;color:#666;text-transform:uppercase}.filters[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:20px;background:#f9f9f9;padding:15px;border-radius:8px}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:700}.filter-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px;border:1px solid #ccc;border-radius:4px}.table-wrapper[_ngcontent-%COMP%]{background:#fff;border:1px solid #ddd;border-radius:8px;overflow:hidden}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%]{text-align:left;background:#f4f4f4;padding:12px;border-bottom:2px solid #ddd}td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #eee}tr.is-today[_ngcontent-%COMP%]{background-color:#fff9f0}tr.is-today[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #ffeeba}tr.is-urgent[_ngcontent-%COMP%]{border-left:5px solid #e74c3c}.client-name[_ngcontent-%COMP%]{font-weight:700;color:#2c3e50}.timestamp[_ngcontent-%COMP%]{font-size:.8rem;color:#666}.badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:.8rem;font-weight:700}.badge.pendiente[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.badge.en-proceso[_ngcontent-%COMP%]{background:#cce5ff;color:#004085}.badge.producido[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.badge.entregado[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.note-tag[_ngcontent-%COMP%]{font-size:.75rem;padding:2px 5px;border-radius:4px;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:150px}.note-tag.pastelero[_ngcontent-%COMP%]{background:#fdf2f2;color:#9b1c1c;border:1px solid #f8d7da}.note-tag.tienda[_ngcontent-%COMP%]{background:#f0f9ff;color:#075985;border:1px solid #bae6fd}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#666}.btn-action[_ngcontent-%COMP%]{background:#34495e;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:.85rem}.btn-action[_ngcontent-%COMP%]:hover{background:#2c3e50}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:5px}.btn-quick-ready[_ngcontent-%COMP%]{background:#27ae60;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;font-size:.85rem;font-weight:700}.btn-quick-ready[_ngcontent-%COMP%]:disabled{background:#ccc}.btn-quick-ready[_ngcontent-%COMP%]:hover:not(:disabled){background:#219150}"]})};export{ae as PedidosListComponent};
