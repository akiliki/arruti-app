import{a as v,b as m}from"./chunk-CMYXJOK7.js";import{a as p,b as R}from"./chunk-PY7FXQZV.js";import{Fa as b,M as o,P as u,V as n,a as s,b as i,j as l,m as d,q as c,y as f}from"./chunk-CMV2EMBO.js";var S=class a{http=n(R);adapter=n(v);apiUrl=m.apiUrl;recetasState=new l([]);recetasSignal=b([]);loaded=!1;constructor(){this.recetasState.subscribe(e=>this.recetasSignal.set(e))}getRecetas(){return this.loaded?this.recetasState.asObservable():this.refreshRecetas()}refreshRecetas(){return this.http.get(`${this.apiUrl}?type=recetas`).pipe(c(e=>{if(e.status==="error")throw new Error(e.message);let t=this.adapter.adaptRecetas(e);return this.recetasState.next(t),this.loaded=!0,t}),f(e=>(console.error("Error fetching recetas:",e),d([]))))}getRecetasByProducto(e){return this.getRecetas().pipe(c(t=>t.filter(r=>r.idProducto===e)))}saveReceta(e){let t=i(s({},this.adapter.prepareRecetaForPost(e)),{action:"addReceta"});return this.http.post(this.apiUrl,JSON.stringify(t),{headers:new p({"Content-Type":"text/plain;charset=utf-8"})}).pipe(o(()=>{let r=this.recetasState.value;this.recetasState.next([...r,e])}))}updateReceta(e){let t=i(s({},this.adapter.prepareRecetaForPost(e)),{action:"updateReceta"});return this.http.post(this.apiUrl,JSON.stringify(t),{headers:new p({"Content-Type":"text/plain;charset=utf-8"})}).pipe(o(()=>{let r=this.recetasState.value,h=r.findIndex(g=>g.id===e.id);h!==-1&&(r[h]=e,this.recetasState.next([...r]))}))}static \u0275fac=function(t){return new(t||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{S as a};
