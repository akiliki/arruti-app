import{a as $}from"./chunk-XOLXCWRL.js";import{a as L}from"./chunk-J22CBIBM.js";import{b as I,c as b,d as N,e as T,g as V,j as G,k as A,l as z,m as D,n as B,o as q,p as U,q as j,r as H}from"./chunk-BY3Z742B.js";import"./chunk-CMYXJOK7.js";import{e as w,g as R,k as y}from"./chunk-PY7FXQZV.js";import{Fa as C,Ka as v,Lb as S,Na as l,Ob as F,Pb as E,Qa as n,Ra as t,Sa as f,V as m,Va as x,Wa as p,Wb as k,Xa as s,Z as P,cb as r,db as M,eb as _,ga as g,ha as u,hb as O,za as d}from"./chunk-CMV2EMBO.js";function K(c,o){c&1&&(n(0,"div",6),r(1," Cargando datos del producto... "),t())}function Q(c,o){if(c&1){let e=x();n(0,"div",7)(1,"p",8),r(2),t(),n(3,"button",2),p("click",function(){g(e);let a=s();return u(a.goBack())}),r(4,"Volver"),t()()}if(c&2){let e=s();d(2),_("Error: ",e.error(),"")}}function W(c,o){if(c&1&&(n(0,"option",30),r(1),t()),c&2){let e=o.$implicit;l("value",e),d(),M(e)}}function X(c,o){if(c&1){let e=x();n(0,"tr",31)(1,"td"),f(2,"input",32),t(),n(3,"td"),f(4,"input",33),t(),n(5,"td")(6,"select",34)(7,"option",35),r(8,"gr"),t(),n(9,"option",36),r(10,"kg"),t(),n(11,"option",37),r(12,"ml"),t(),n(13,"option",38),r(14,"l"),t(),n(15,"option",39),r(16,"ud"),t(),n(17,"option",40),r(18,"pizca"),t()()(),n(19,"td")(20,"button",41),p("click",function(){let a=g(e).index,h=s(2);return u(h.removeIngrediente(a))}),r(21,"\xD7"),t()()()}if(c&2){let e=o.index;l("formGroupName",e)}}function Y(c,o){if(c&1){let e=x();n(0,"div",9)(1,"div",10)(2,"h3"),r(3),t(),n(4,"p",11),r(5),t()(),n(6,"form",12),p("ngSubmit",function(){g(e);let a=s();return u(a.onSubmit())}),n(7,"div",13)(8,"label",14),r(9,"Tama\xF1o / Raciones"),t(),n(10,"select",15)(11,"option",16),r(12,"Seleccionar tama\xF1o..."),t(),v(13,W,2,2,"option",17),n(14,"option",18),r(15,"General (Todas las tallas)"),t()()(),n(16,"div",13)(17,"label"),r(18,"Ingredientes"),t(),n(19,"div",19)(20,"table",20)(21,"thead")(22,"tr")(23,"th"),r(24,"Ingrediente"),t(),n(25,"th"),r(26,"Cant."),t(),n(27,"th"),r(28,"Unidad"),t(),f(29,"th"),t()(),n(30,"tbody"),v(31,X,22,1,"tr",21),t()(),n(32,"button",22),p("click",function(){g(e);let a=s();return u(a.addIngrediente())}),r(33,"+ A\xF1adir Ingrediente"),t()()(),n(34,"div",13)(35,"label",23),r(36,"Pasos a seguir"),t(),f(37,"textarea",24),t(),n(38,"div",13)(39,"label",25),r(40,"Tiempo de elaboraci\xF3n total"),t(),f(41,"input",26),t(),n(42,"div",27)(43,"button",28),p("click",function(){g(e);let a=s();return u(a.goBack())}),r(44,"Cancelar"),t(),n(45,"button",29),r(46),t()()()()}if(c&2){let e=s();d(3),_("Producto: ",e.producto.producto,""),d(2),_("Familia: ",e.producto.familia,""),d(),l("formGroup",e.recetaForm),d(7),l("ngForOf",e.producto.tallasRaciones),d(18),l("ngForOf",e.ingredientes.controls),d(14),l("disabled",e.recetaForm.invalid||e.saving()),d(),_(" ",e.saving()?"Guardando...":e.isEditMode?"Actualizar Receta":"Guardar Receta"," ")}}var J=class c{fb=m(j);route=m(w);router=m(R);location=m(S);recetaService=m($);productoService=m(L);recetaForm;isEditMode=!1;producto;loading=C(!0);saving=C(!1);error=C(null);constructor(){this.recetaForm=this.fb.group({raciones:["",b.required],ingredientes:this.fb.array([]),pasos:["",b.required],tiempoTotal:["",b.required]})}get ingredientes(){return this.recetaForm.get("ingredientes")}addIngrediente(){let o=this.fb.group({nombre:["",b.required],cantidad:[""],unidad:["gr"]});this.ingredientes.push(o)}removeIngrediente(o){this.ingredientes.removeAt(o)}ngOnInit(){let o=this.route.snapshot.paramMap.get("id"),e=this.route.snapshot.paramMap.get("idReceta");if(!o){this.error.set("No se proporcion\xF3 el ID del producto."),this.loading.set(!1);return}this.ingredientes.length===0&&this.addIngrediente(),this.productoService.getProductos().subscribe(i=>{if(this.producto=i.find(a=>a.id===o),!this.producto){this.error.set("Producto no encontrado."),this.loading.set(!1);return}e?(this.isEditMode=!0,this.loadReceta(e)):this.loading.set(!1)})}loadReceta(o){this.recetaService.getRecetas().subscribe(e=>{let i=e.find(a=>a.id===o);i?(this.recetaForm.patchValue({raciones:i.raciones,pasos:i.pasos,tiempoTotal:i.tiempoTotal}),this.ingredientes.clear(),i.ingredientes.forEach(a=>{let h=this.fb.group({nombre:[a.nombre,b.required],cantidad:[a.cantidad],unidad:[a.unidad]});this.ingredientes.push(h)})):this.error.set("Receta no encontrada."),this.loading.set(!1)})}onSubmit(){if(this.recetaForm.invalid||!this.producto)return;this.saving.set(!0);let o=this.recetaForm.value,e={id:this.isEditMode?this.route.snapshot.paramMap.get("idReceta"):crypto.randomUUID(),idProducto:this.producto.id,nombreProducto:this.producto.producto,raciones:o.raciones,ingredientes:o.ingredientes,pasos:o.pasos,tiempoTotal:o.tiempoTotal};(this.isEditMode?this.recetaService.updateReceta(e):this.recetaService.saveReceta(e)).subscribe({next:()=>{this.saving.set(!1),this.goBack()},error:a=>{console.error("Error saving receta:",a),this.error.set("Error al guardar la receta. Int\xE9ntelo de nuevo."),this.saving.set(!1)}})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=P({type:c,selectors:[["app-receta-form"]],standalone:!0,features:[O],decls:9,vars:4,consts:[[1,"page-container"],[1,"header"],[1,"btn-back",3,"click"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","card",4,"ngIf"],[1,"loading"],[1,"error"],[1,"error-text"],[1,"card"],[1,"product-info"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","raciones"],["id","raciones","formControlName","raciones"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","General"],["formArrayName","ingredientes",1,"ingredients-table-wrapper"],[1,"ingredients-table"],[3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn-add-ing",3,"click"],["for","pasos"],["id","pasos","formControlName","pasos","placeholder","Instrucciones paso a paso..."],["for","tiempoTotal"],["type","text","id","tiempoTotal","formControlName","tiempoTotal","placeholder","Ej: 45 min, 2h 30min..."],[1,"form-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-save",3,"disabled"],[3,"value"],[3,"formGroupName"],["type","text","formControlName","nombre","placeholder","Harina, Az\xFAcar..."],["type","text","formControlName","cantidad","placeholder","500"],["formControlName","unidad"],["value","gr"],["value","kg"],["value","ml"],["value","l"],["value","ud"],["value","pizca"],["type","button",1,"btn-remove-ing",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),p("click",function(){return i.goBack()}),r(3,"\u2190 Volver"),t(),n(4,"h2"),r(5),t()(),v(6,K,2,0,"div",3)(7,Q,5,1,"div",4)(8,Y,47,7,"div",5),t()),e&2&&(d(5),M(i.isEditMode?"Editar Receta":"Nueva Receta"),d(),l("ngIf",i.loading()),d(),l("ngIf",i.error()),d(),l("ngIf",!i.loading()&&!i.error()&&i.producto))},dependencies:[k,F,E,H,V,q,U,I,B,N,T,G,D,A,z,y],styles:["*[_ngcontent-%COMP%], *[_ngcontent-%COMP%]:before, *[_ngcontent-%COMP%]:after{box-sizing:border-box}body[_ngcontent-%COMP%]{margin:0;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background-color:#f5f5f5}[_ngcontent-%COMP%]:focus-visible{outline:2px solid #3b82f6;outline-offset:2px}.main-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem 1rem}.page-container[_ngcontent-%COMP%]{padding:1.5rem;max-width:800px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:2rem}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#1e293b}.btn-back[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#fff;border:1px solid #e2e8f0;border-radius:8px;cursor:pointer;color:#64748b;font-weight:500}.btn-back[_ngcontent-%COMP%]:hover{background:#f8fafc}.card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:16px;box-shadow:0 4px 6px -1px #0000001a}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:600;color:#475569}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:2px solid #e2e8f0;border-radius:10px;font-size:1rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:120px}.ingredients-table-wrapper[_ngcontent-%COMP%]{background:#f8fafc;padding:1rem;border-radius:12px;border:1px solid #e2e8f0}.ingredients-table-wrapper[_ngcontent-%COMP%]   .ingredients-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:1rem}.ingredients-table-wrapper[_ngcontent-%COMP%]   .ingredients-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;font-size:.75rem;text-transform:uppercase;color:#64748b;padding:.5rem}.ingredients-table-wrapper[_ngcontent-%COMP%]   .ingredients-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.25rem .5rem}.ingredients-table-wrapper[_ngcontent-%COMP%]   .ingredients-table[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .ingredients-table-wrapper[_ngcontent-%COMP%]   .ingredients-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem;border-width:1px;border-radius:6px}.ingredients-table-wrapper[_ngcontent-%COMP%]   .btn-remove-ing[_ngcontent-%COMP%]{background:#fee2e2;color:#ef4444;border:none;width:30px;height:30px;border-radius:50%;cursor:pointer;font-weight:700}.ingredients-table-wrapper[_ngcontent-%COMP%]   .btn-remove-ing[_ngcontent-%COMP%]:hover{background:#fecaca}.ingredients-table-wrapper[_ngcontent-%COMP%]   .btn-add-ing[_ngcontent-%COMP%]{width:100%;padding:.6rem;background:#fff;color:#3b82f6;border:1px dashed #3b82f6;border-radius:8px;font-weight:600;cursor:pointer}.ingredients-table-wrapper[_ngcontent-%COMP%]   .btn-add-ing[_ngcontent-%COMP%]:hover{background:#eff6ff}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem;padding-top:1.5rem;border-top:1px solid #f1f5f9}.btn-cancel[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:#fff;border:1px solid #e2e8f0;border-radius:10px;cursor:pointer}.btn-save[_ngcontent-%COMP%]{padding:.75rem 2rem;background:#3b82f6;color:#fff;border:none;border-radius:10px;font-weight:600;cursor:pointer}.btn-save[_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#64748b}.error-text[_ngcontent-%COMP%]{color:#ef4444}"]})};export{J as RecetaFormComponent};
